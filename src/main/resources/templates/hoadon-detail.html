<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <!-- Sửa lại title để hiển thị mã HĐ đúng -->
    <title th:text="'Hóa đơn #' + ${hoaDon.maHd}">Hóa đơn</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <style>
        body {
            background: #f5f5f5;
        }

        .invoice-wrapper {
            max-width: 700px;
            margin: 30px auto;
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
        }

        .shop-name {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .shop-info {
            font-size: 0.9rem;
            color: #666;
        }

        .invoice-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .table thead th {
            background: #0d6efd;
            color: white;
        }

        @media print {

            .btn-print,
            .btn-back,
            .btn-download {
                display: none;
            }

            body {
                background: white;
            }

            .invoice-wrapper {
                box-shadow: none;
                margin: 0;
                border-radius: 0;
            }
        }
    </style>
</head>

<body>

    <div class="invoice-wrapper">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                <div class="shop-name">BARBERSHOP DEMO</div>
                <div class="shop-info">Địa chỉ: 123 Đường ABC, Quận XYZ, Hà Nội</div>
                <div class="shop-info">Điện thoại: 0900 000 000</div>
            </div>
            <div class="text-end">
                <div class="invoice-title">HÓA ĐƠN DỊCH VỤ</div>
                <div>Mã hóa đơn: <strong th:text="${hoaDon.maHd}"></strong></div>
                <div>Ngày thanh toán:
                    <strong th:text="${#temporals.format(hoaDon.ngayThanhToan, 'dd/MM/yyyy')}"></strong>
                </div>
            </div>
        </div>

        <hr>

        <!-- Thông tin khách / nhân viên -->
        <div class="row mb-3">
            <div class="col-md-6">
                <h6>Khách hàng</h6>
                <p class="mb-1">
                    <strong th:text="${hoaDon.lichHen != null && hoaDon.lichHen.khachHang != null ?
                                   hoaDon.lichHen.khachHang.hoTen : 'Khách lẻ'}"></strong>
                </p>
                <p class="mb-1">
                    SĐT:
                    <span th:text="${hoaDon.lichHen != null && hoaDon.lichHen.khachHang != null ?
                                hoaDon.lichHen.khachHang.sdt : '---'}"></span>
                </p>
            </div>
            <div class="col-md-6">
                <h6>Thực hiện bởi</h6>
                <p class="mb-1">
                    Nhân viên:
                    <strong th:text="${hoaDon.lichHen != null && hoaDon.lichHen.nhanVien != null ?
                                   hoaDon.lichHen.nhanVien.hoTen : '---'}"></strong>
                </p>
                <p class="mb-1">
                    Ngày giờ hẹn:
                    <span th:if="${hoaDon.lichHen != null}" th:text="${#temporals.format(hoaDon.lichHen.ngayHen,'dd/MM/yyyy') + ' ' +
                                   #temporals.format(hoaDon.lichHen.gioHen,'HH:mm')}">
                    </span>
                </p>
            </div>
        </div>

        <!-- Bảng dịch vụ -->
        <h6 class="mt-3 mb-2">Chi tiết dịch vụ</h6>
        <table class="table table-sm align-middle">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Dịch vụ</th>
                    <th class="text-end">Đơn giá (₫)</th>
                </tr>
            </thead>
            <tbody>
                <tr th:if="${#lists.isEmpty(dsDichVu)}">
                    <td colspan="3"><em>Không có dịch vụ nào gắn với hóa đơn này.</em></td>
                </tr>
                <tr th:each="item, stt : ${dsDichVu}">
                    <td th:text="${stt.count}"></td>
                    <td th:text="${item.dichVu.tenDv}"></td>
                    <td class="text-end" th:text="${#numbers.formatDecimal(item.dichVu.gia,0,'COMMA',0,'POINT')}">
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Tổng tiền & phương thức thanh toán -->
        <div class="d-flex justify-content-end mt-3">
            <div style="min-width: 250px;">
                <div class="d-flex justify-content-between">
                    <span>Phương thức thanh toán:</span>
                    <strong th:text="${hoaDon.phuongThucTt}"></strong>
                </div>
                <div class="d-flex justify-content-between mt-2">
                    <span>Tổng tiền:</span>
                    <strong class="text-danger fs-5"
                        th:text="${#numbers.formatDecimal(tongTienDv,0,'COMMA',0,'POINT')} + ' ₫'">
                    </strong>
                </div>
            </div>
        </div>

        <div class="mt-4 d-flex justify-content-between">
            <button type="button" class="btn btn-secondary btn-back" onclick="window.history.back()">← Quay lại</button>

            <div class="d-flex gap-2">
                <!-- Tải PDF -->
                <a class="btn btn-outline-dark btn-download" th:href="@{'/admin/hoadon/export-pdf/' + ${hoaDon.maHd}}"
                    target="_blank">
                    <i class="fa-solid fa-file-pdf me-1"></i> Tải PDF
                </a>

                <!-- In trực tiếp từ trình duyệt -->
                <button type="button" class="btn btn-primary btn-print" onclick="window.print()">
                    In hóa đơn
                </button>
            </div>
        </div>
    </div>

</body>

</html>